select aaa.* from (
SELECT m.CityName,kc4.provinceName,kc4.categoryName 类4,kc3.categoryName 类3,kc2.categoryName 类2,kc1.categoryName 类1,
COUNT(*)  上传数量,kr.knowledgeViewerCount 知识浏览次数
FROM KnowledgeRecord kr 
LEFT JOIN Demand m ON m.Id=kr.actionCode 
JOIN KnowledgeCategory kc1 ON kc1.id = kr.knowledgeCategoryId	
JOIN KnowledgeCategory kc2 ON kc2.id = kc1.pId	
JOIN KnowledgeCategory kc3 ON kc3.id = kc2.pId	
JOIN KnowledgeCategory kc4 ON kc4.id = kc3.pId	
WHERE kc4.provinceName='广西壮族自治区' 
and ((kr.actionType='demand' and m.`Status`=1 and m.isBest=1) -- 工单加精
or kr.actionType='document') -- 或文档
and kr.createDateTime <date_sub(date_format(now(),'%y-%m-%d 18:00:00') ,interval 0 DAY)
GROUP BY kc1.provinceName,
kc4.categoryName,kc3.categoryName,kc2.categoryName,kc1.categoryName,m.CityName
UNION all
SELECT m.CityName,kc3.provinceName,kc3.categoryName 类4,kc2.categoryName 类3,kc1.categoryName 类2,null,
COUNT(*)  上传数量,kr.knowledgeViewerCount 知识浏览次数
FROM KnowledgeRecord kr 
LEFT JOIN Demand m ON m.Id=kr.actionCode 
JOIN KnowledgeCategory kc1 ON kc1.id = kr.knowledgeCategoryId	
JOIN KnowledgeCategory kc2 ON kc2.id = kc1.pId	
JOIN KnowledgeCategory kc3 ON kc3.id = kc2.pId	
WHERE kc3.provinceName='广西壮族自治区' 
and ((kr.actionType='demand' and m.`Status`=1 and m.isBest=1) -- 工单加精
or kr.actionType='document') -- 或文档
and kr.createDateTime <date_sub(date_format(now(),'%y-%m-%d 18:00:00') ,interval 0 DAY)
GROUP BY kc3.provinceName,kc3.categoryName,kc2.categoryName,kc1.categoryName,m.CityName
UNION all
SELECT m.CityName,kc2.provinceName,kc2.categoryName 类4,kc1.categoryName 类3,null,NULL,
COUNT(*)  上传数量,kr.knowledgeViewerCount 知识浏览次数
FROM KnowledgeRecord kr 
LEFT JOIN Demand m ON m.Id=kr.actionCode 
JOIN KnowledgeCategory kc1 ON kc1.id = kr.knowledgeCategoryId	
JOIN KnowledgeCategory kc2 ON kc2.id = kc1.pId	
WHERE kc2.provinceName='广西壮族自治区' -- and kc2.provinceName in('重庆市','云南省')
and ((kr.actionType='demand' and m.`Status`=1 and m.isBest=1) -- 工单加精
or kr.actionType='document') -- 或文档
and kr.createDateTime <date_sub(date_format(now(),'%y-%m-%d 18:00:00') ,interval 0 DAY)
GROUP BY kc2.provinceName,kc2.categoryName,kc1.categoryName,m.CityName
) aaa where aaa.类4='省分知识库'